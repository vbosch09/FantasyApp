/*
Deployment script for FantasyFootball

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "FantasyFootball"
:setvar DefaultFilePrefix "FantasyFootball"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
PRINT N'Rename refactoring operation with key 7090386c-0b40-4d08-98d3-e76f08ae7217 is skipped, element [dbo].[Players].[Id] (SqlSimpleColumn) will not be renamed to PlayerId';


GO
PRINT N'Rename refactoring operation with key 0fbaeb56-8b12-4c45-876d-01f5b0d31dc8 is skipped, element [dbo].[Drafts].[Id] (SqlSimpleColumn) will not be renamed to DraftId';


GO
PRINT N'Rename refactoring operation with key 4957598a-53e6-460d-a6b3-dc291ab302d5 is skipped, element [dbo].[DraftPicks].[Id] (SqlSimpleColumn) will not be renamed to DraftPickId';


GO
PRINT N'Rename refactoring operation with key 936764bc-a75d-4020-8e40-40f82a7daaae is skipped, element [dbo].[DraftPicks].[Round] (SqlSimpleColumn) will not be renamed to PickNumber';


GO
PRINT N'Rename refactoring operation with key ac5ce3a3-7739-4630-a0d6-9cd0df989708 is skipped, element [dbo].[FantasyTeams].[Id] (SqlSimpleColumn) will not be renamed to FantasyTeamId';


GO
PRINT N'Rename refactoring operation with key 37d25de4-22e8-4608-a5b1-7aec81694cb1 is skipped, element [dbo].[Seasons].[DraftId] (SqlSimpleColumn) will not be renamed to SeasonId';


GO
PRINT N'Rename refactoring operation with key dc3b156b-d1ba-46b5-9919-154bf8b353e0 is skipped, element [dbo].[Owners].[Id] (SqlSimpleColumn) will not be renamed to OwnerId';


GO
PRINT N'Rename refactoring operation with key 27c8662d-1953-4a96-8acf-5cf3214b8153 is skipped, element [dbo].[FK_FantasyTeams_ToTable] (SqlForeignKeyConstraint) will not be renamed to [FK_FantasyTeams_Seasons]';


GO
PRINT N'Rename refactoring operation with key d8453099-7e57-4094-a5ba-67a625feb731 is skipped, element [dbo].[ConfigTable].[Id] (SqlSimpleColumn) will not be renamed to ConfigId';


GO
PRINT N'Dropping unnamed constraint on [dbo].[DraftPicks]...';


GO
ALTER TABLE [dbo].[DraftPicks] DROP CONSTRAINT [DF__DraftPick__Keepe__5535A963];


GO
PRINT N'Dropping [dbo].[FK_DraftPicks_ToPlayers]...';


GO
ALTER TABLE [dbo].[DraftPicks] DROP CONSTRAINT [FK_DraftPicks_ToPlayers];


GO
PRINT N'Dropping [dbo].[FK_DraftPicks_ToDrafts]...';


GO
ALTER TABLE [dbo].[DraftPicks] DROP CONSTRAINT [FK_DraftPicks_ToDrafts];


GO
PRINT N'Dropping [dbo].[FK_FantasyTeams_Owners]...';


GO
ALTER TABLE [dbo].[FantasyTeams] DROP CONSTRAINT [FK_FantasyTeams_Owners];


GO
PRINT N'Dropping [dbo].[FK_FantasyTeams_Seasons]...';


GO
ALTER TABLE [dbo].[FantasyTeams] DROP CONSTRAINT [FK_FantasyTeams_Seasons];


GO
PRINT N'Starting rebuilding table [dbo].[DraftPicks]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_DraftPicks] (
    [DraftPickId] INT IDENTITY (1, 1) NOT NULL,
    [PlayerId]    INT NOT NULL,
    [DraftId]     INT NOT NULL,
    [PickNumber]  INT NOT NULL,
    [RosterId]    INT NULL,
    [Keeper]      BIT DEFAULT 0 NOT NULL,
    PRIMARY KEY CLUSTERED ([DraftPickId] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UN_DraftPicks_PlayerIdDraftId1] UNIQUE NONCLUSTERED ([PlayerId] ASC, [DraftId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[DraftPicks])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_DraftPicks] ON;
        INSERT INTO [dbo].[tmp_ms_xx_DraftPicks] ([DraftPickId], [PlayerId], [DraftId], [PickNumber], [RosterId], [Keeper])
        SELECT   [DraftPickId],
                 [PlayerId],
                 [DraftId],
                 [PickNumber],
                 [RosterId],
                 [Keeper]
        FROM     [dbo].[DraftPicks]
        ORDER BY [DraftPickId] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_DraftPicks] OFF;
    END

DROP TABLE [dbo].[DraftPicks];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_DraftPicks]', N'DraftPicks';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UN_DraftPicks_PlayerIdDraftId1]', N'UN_DraftPicks_PlayerIdDraftId', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[FantasyTeams]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_FantasyTeams] (
    [FantasyTeamId] INT          IDENTITY (1, 1) NOT NULL,
    [SleeperTeamId] NCHAR (10)   NOT NULL,
    [OwnerId]       INT          NOT NULL,
    [SeasonId]      INT          NOT NULL,
    [TeamName]      VARCHAR (50) NULL,
    PRIMARY KEY CLUSTERED ([FantasyTeamId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[FantasyTeams])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_FantasyTeams] ON;
        INSERT INTO [dbo].[tmp_ms_xx_FantasyTeams] ([FantasyTeamId], [SleeperTeamId], [OwnerId], [SeasonId], [TeamName])
        SELECT   [FantasyTeamId],
                 [SleeperTeamId],
                 [OwnerId],
                 [SeasonId],
                 [TeamName]
        FROM     [dbo].[FantasyTeams]
        ORDER BY [FantasyTeamId] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_FantasyTeams] OFF;
    END

DROP TABLE [dbo].[FantasyTeams];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_FantasyTeams]', N'FantasyTeams';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Owners]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Owners] (
    [OwnerId]   INT           IDENTITY (1, 1) NOT NULL,
    [FirstName] VARCHAR (50)  NOT NULL,
    [LastName]  VARCHAR (50)  NOT NULL,
    [Email]     VARCHAR (100) NULL,
    PRIMARY KEY CLUSTERED ([OwnerId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Owners])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Owners] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Owners] ([OwnerId], [FirstName], [LastName], [Email])
        SELECT   [OwnerId],
                 [FirstName],
                 [LastName],
                 [Email]
        FROM     [dbo].[Owners]
        ORDER BY [OwnerId] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Owners] OFF;
    END

DROP TABLE [dbo].[Owners];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Owners]', N'Owners';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Players]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Players] (
    [PlayerId]        INT           IDENTITY (1, 1) NOT NULL,
    [SleeperPlayerId] INT           NOT NULL,
    [FirstName]       VARCHAR (50)  NOT NULL,
    [LastName]        VARCHAR (100) NOT NULL,
    [Team]            VARCHAR (5)   NOT NULL,
    [Position]        VARCHAR (50)  NOT NULL,
    PRIMARY KEY CLUSTERED ([PlayerId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Players])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Players] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Players] ([PlayerId], [SleeperPlayerId], [FirstName], [LastName], [Team], [Position])
        SELECT   [PlayerId],
                 [SleeperPlayerId],
                 [FirstName],
                 [LastName],
                 [Team],
                 [Position]
        FROM     [dbo].[Players]
        ORDER BY [PlayerId] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Players] OFF;
    END

DROP TABLE [dbo].[Players];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Players]', N'Players';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating [dbo].[FK_DraftPicks_ToPlayers]...';


GO
ALTER TABLE [dbo].[DraftPicks] WITH NOCHECK
    ADD CONSTRAINT [FK_DraftPicks_ToPlayers] FOREIGN KEY ([PlayerId]) REFERENCES [dbo].[Players] ([PlayerId]);


GO
PRINT N'Creating [dbo].[FK_DraftPicks_ToDrafts]...';


GO
ALTER TABLE [dbo].[DraftPicks] WITH NOCHECK
    ADD CONSTRAINT [FK_DraftPicks_ToDrafts] FOREIGN KEY ([DraftId]) REFERENCES [dbo].[Seasons] ([SeasonId]);


GO
PRINT N'Creating [dbo].[FK_FantasyTeams_Owners]...';


GO
ALTER TABLE [dbo].[FantasyTeams] WITH NOCHECK
    ADD CONSTRAINT [FK_FantasyTeams_Owners] FOREIGN KEY ([OwnerId]) REFERENCES [dbo].[Owners] ([OwnerId]);


GO
PRINT N'Creating [dbo].[FK_FantasyTeams_Seasons]...';


GO
ALTER TABLE [dbo].[FantasyTeams] WITH NOCHECK
    ADD CONSTRAINT [FK_FantasyTeams_Seasons] FOREIGN KEY ([SeasonId]) REFERENCES [dbo].[Seasons] ([SeasonId]);


GO
PRINT N'Creating [dbo].[Fantasy_InsertPlayer]...';


GO
CREATE PROCEDURE [dbo].[Fantasy_InsertPlayer]
	@in_SleeperPlayerId int,
	@in_FirstName varchar,
	@in_LastName varchar,
	@in_Team varchar,
	@in_Position varchar
AS
	
INSERT INTO Players VALUES (@in_SleeperPlayerId, @in_FirstName, @in_LastName, @in_Team, @in_Position)
GO
PRINT N'Creating [dbo].[Fantasy_SelectAllPlayerData]...';


GO
CREATE PROCEDURE [dbo].[Fantasy_SelectAllPlayerData]
	
AS
	SELECT PlayerId, SleeperPlayerId, FirstName, LastName, Team, Position
	FROM Players
GO
PRINT N'Creating [dbo].[Fantasy_SelectPlayerBySleeperId]...';


GO
CREATE PROCEDURE [dbo].[Fantasy_SelectPlayerBySleeperId]
(
	@in_SleeperId bigint
)
AS
	SELECT PlayerId, FirstName, LastName, SleeperPlayerId, Team, Position
	FROM Players
	WHERE SleeperPlayerId = @in_SleeperId
GO
