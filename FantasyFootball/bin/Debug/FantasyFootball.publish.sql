/*
Deployment script for FantasyFootball

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "FantasyFootball"
:setvar DefaultFilePrefix "FantasyFootball"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
PRINT N'Rename refactoring operation with key 7090386c-0b40-4d08-98d3-e76f08ae7217 is skipped, element [dbo].[Players].[Id] (SqlSimpleColumn) will not be renamed to PlayerId';


GO
PRINT N'Rename refactoring operation with key 0fbaeb56-8b12-4c45-876d-01f5b0d31dc8 is skipped, element [dbo].[Drafts].[Id] (SqlSimpleColumn) will not be renamed to DraftId';


GO
PRINT N'Rename refactoring operation with key 4957598a-53e6-460d-a6b3-dc291ab302d5 is skipped, element [dbo].[DraftPicks].[Id] (SqlSimpleColumn) will not be renamed to DraftPickId';


GO
PRINT N'Rename refactoring operation with key 936764bc-a75d-4020-8e40-40f82a7daaae is skipped, element [dbo].[DraftPicks].[Round] (SqlSimpleColumn) will not be renamed to PickNumber';


GO
PRINT N'Rename refactoring operation with key ac5ce3a3-7739-4630-a0d6-9cd0df989708 is skipped, element [dbo].[FantasyTeams].[Id] (SqlSimpleColumn) will not be renamed to FantasyTeamId';


GO
PRINT N'Rename refactoring operation with key 37d25de4-22e8-4608-a5b1-7aec81694cb1 is skipped, element [dbo].[Seasons].[DraftId] (SqlSimpleColumn) will not be renamed to SeasonId';


GO
PRINT N'Rename refactoring operation with key dc3b156b-d1ba-46b5-9919-154bf8b353e0 is skipped, element [dbo].[Owners].[Id] (SqlSimpleColumn) will not be renamed to OwnerId';


GO
PRINT N'Rename refactoring operation with key 27c8662d-1953-4a96-8acf-5cf3214b8153 is skipped, element [dbo].[FK_FantasyTeams_ToTable] (SqlForeignKeyConstraint) will not be renamed to [FK_FantasyTeams_Seasons]';


GO
PRINT N'Rename refactoring operation with key d8453099-7e57-4094-a5ba-67a625feb731 is skipped, element [dbo].[ConfigTable].[Id] (SqlSimpleColumn) will not be renamed to ConfigId';


GO
PRINT N'Creating [dbo].[ConfigTable]...';


GO
CREATE TABLE [dbo].[ConfigTable] (
    [ConfigId] INT           NOT NULL,
    [Name]     VARCHAR (100) NOT NULL,
    [Value]    VARCHAR (100) NOT NULL,
    [ModTime]  DATETIME      NOT NULL,
    PRIMARY KEY CLUSTERED ([ConfigId] ASC)
);


GO
PRINT N'Creating [dbo].[DraftPicks]...';


GO
CREATE TABLE [dbo].[DraftPicks] (
    [DraftPickId] INT NOT NULL,
    [PlayerId]    INT NOT NULL,
    [DraftId]     INT NOT NULL,
    [PickNumber]  INT NOT NULL,
    [RosterId]    INT NULL,
    [Keeper]      BIT NOT NULL,
    PRIMARY KEY CLUSTERED ([DraftPickId] ASC),
    CONSTRAINT [UN_DraftPicks_PlayerIdDraftId] UNIQUE NONCLUSTERED ([PlayerId] ASC, [DraftId] ASC)
);


GO
PRINT N'Creating [dbo].[FantasyTeams]...';


GO
CREATE TABLE [dbo].[FantasyTeams] (
    [FantasyTeamId] INT          NOT NULL,
    [SleeperTeamId] NCHAR (10)   NOT NULL,
    [OwnerId]       INT          NOT NULL,
    [SeasonId]      INT          NOT NULL,
    [TeamName]      VARCHAR (50) NULL,
    PRIMARY KEY CLUSTERED ([FantasyTeamId] ASC)
);


GO
PRINT N'Creating [dbo].[Owners]...';


GO
CREATE TABLE [dbo].[Owners] (
    [OwnerId]   INT           NOT NULL,
    [FirstName] VARCHAR (50)  NOT NULL,
    [LastName]  VARCHAR (50)  NOT NULL,
    [Email]     VARCHAR (100) NULL,
    PRIMARY KEY CLUSTERED ([OwnerId] ASC)
);


GO
PRINT N'Creating [dbo].[Players]...';


GO
CREATE TABLE [dbo].[Players] (
    [PlayerId]        INT           NOT NULL,
    [SleeperPlayerId] INT           NOT NULL,
    [FirstName]       VARCHAR (50)  NOT NULL,
    [LastName]        VARCHAR (100) NOT NULL,
    [Team]            VARCHAR (5)   NOT NULL,
    [Position]        VARCHAR (50)  NOT NULL,
    PRIMARY KEY CLUSTERED ([PlayerId] ASC)
);


GO
PRINT N'Creating [dbo].[Seasons]...';


GO
CREATE TABLE [dbo].[Seasons] (
    [SeasonId]        INT    IDENTITY (1, 1) NOT NULL,
    [Year]            INT    NOT NULL,
    [DraftComplete]   BIT    NOT NULL,
    [SleeperLeagueId] BIGINT NOT NULL,
    [SleeperDraftId]  BIGINT NULL,
    PRIMARY KEY CLUSTERED ([SeasonId] ASC),
    UNIQUE NONCLUSTERED ([Year] ASC)
);


GO
PRINT N'Creating unnamed constraint on [dbo].[DraftPicks]...';


GO
ALTER TABLE [dbo].[DraftPicks]
    ADD DEFAULT 0 FOR [Keeper];


GO
PRINT N'Creating unnamed constraint on [dbo].[Seasons]...';


GO
ALTER TABLE [dbo].[Seasons]
    ADD DEFAULT 0 FOR [DraftComplete];


GO
PRINT N'Creating [dbo].[FK_DraftPicks_ToPlayers]...';


GO
ALTER TABLE [dbo].[DraftPicks] WITH NOCHECK
    ADD CONSTRAINT [FK_DraftPicks_ToPlayers] FOREIGN KEY ([PlayerId]) REFERENCES [dbo].[Players] ([PlayerId]);


GO
PRINT N'Creating [dbo].[FK_DraftPicks_ToDrafts]...';


GO
ALTER TABLE [dbo].[DraftPicks] WITH NOCHECK
    ADD CONSTRAINT [FK_DraftPicks_ToDrafts] FOREIGN KEY ([DraftId]) REFERENCES [dbo].[Seasons] ([SeasonId]);


GO
PRINT N'Creating [dbo].[FK_FantasyTeams_Owners]...';


GO
ALTER TABLE [dbo].[FantasyTeams] WITH NOCHECK
    ADD CONSTRAINT [FK_FantasyTeams_Owners] FOREIGN KEY ([OwnerId]) REFERENCES [dbo].[Owners] ([OwnerId]);


GO
PRINT N'Creating [dbo].[FK_FantasyTeams_Seasons]...';


GO
ALTER TABLE [dbo].[FantasyTeams] WITH NOCHECK
    ADD CONSTRAINT [FK_FantasyTeams_Seasons] FOREIGN KEY ([SeasonId]) REFERENCES [dbo].[Seasons] ([SeasonId]);


GO
PRINT N'Creating [dbo].[Fantasy_InsertPlayer]...';


GO
CREATE PROCEDURE [dbo].[Fantasy_InsertPlayer]
	@in_SleeperPlayerId int,
	@in_FirstName varchar,
	@in_LastName varchar,
	@in_Team varchar,
	@in_Position varchar
AS
	
INSERT INTO Players VALUES (@in_SleeperPlayerId, @in_FirstName, @in_LastName, @in_Team, @in_Position)
GO
PRINT N'Creating [dbo].[Fantasy_SelectAllPlayerData]...';


GO
CREATE PROCEDURE [dbo].[Fantasy_SelectAllPlayerData]
	
AS
	SELECT PlayerId, SleeperPlayerId, FirstName, LastName, Team, Position
	FROM Players
GO
PRINT N'Creating [dbo].[Fantasy_SelectPlayerBySleeperId]...';


GO
CREATE PROCEDURE [dbo].[Fantasy_SelectPlayerBySleeperId]
(
	@in_SleeperId bigint
)
AS
	SELECT PlayerId, FirstName, LastName, SleeperPlayerId, Team, Position
	FROM Players
	WHERE SleeperPlayerId = @in_SleeperId
GO
